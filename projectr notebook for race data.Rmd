---
title: "R Notebook"
output: html_notebook
---

```{r}
setwd("C:/Users/brian/OneDrive/3 Data Science/Data Science Project")
library(ggplot2)
library(datasets)
library(mice)
library(VIM)
library(reshape)
library(data.table)
library(graphics)
library(car)
library(maps)
library(plyr)
```

```{r}
county_facts <- read.csv("county_facts.csv")
pres16results <- read.csv("pres16results.csv")
pe16rwvd9 <- read.csv("pres.elect16.results.wide.votes.dec9.csv")
primres <- read.csv("primary_results.csv")
data(county.fips, state.fips)
fips = county.fips
```

```{r}
#Testing each data set for missingness
#County facts
aggr1_plotfacts <- aggr(county_facts, col = c('Blue','Purple'), numbers = TRUE, sortVars = TRUE, cex.axis = .8, gap = 3, ylab = c('County Facts Histogram of Missing Data','Pattern'))

#presidential election 2016 results
aggr1pres <- aggr(pres16results, col = c('Blue','Purple'), numbers = TRUE, sortVars = TRUE, cex.axis = .8, gap = 3, ylab = c('Presidential Results Histogram of Missing Data','Pattern'))

#wide results
aggr1wide <- aggr(pe16rwvd9, col = c('Blue','Purple'), numbers = TRUE, sortVars = TRUE, cex.axis = .8, gap = 3, ylab = c('Wide Presidential Results Histogram of Missing Data','Pattern'))

#primary dataset
aggr1prim <- aggr(primres, col = c('Blue','Purple'), numbers = TRUE, sortVars = TRUE, cex.axis = .8, gap = 3, ylab = c('Primary Result Histogram of Missing Data','Pattern'))


```

```{r}
########## CLEANING THE WIDE VOTES DATA SET #########
setnames(pe16rwvd9, old = c(8:13, 15:19, 21:39), new = c("other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other", "other"))

#names(pe16rwvd9)[match(c(8:13, 14:19, 21:32),names(pe16rwvd9))] <- "other"

mpe16rwvd9 <- unique(melt(pe16rwvd9, id=(c(1:7)), na.rm = TRUE))
setnames(mpe16rwvd9, old = c("value", "variable"), new= c("Votes", "Candidates"))


#########CLEANING THE pres 16 RESULTS DATA ########
#new data frame with places if missing election data
nodata <- data.frame(pres16results[18352:18475, 1:2])

#find rows where most are  cols 3:9 are NA
pres16results <- pres16results[-c(18352:18475),]

########## CLEANING THE COUNTY FACTS DATA SET #########

county_facts=county_facts[, !(colnames(county_facts) %in% c("AGE135214", "LFE305213", "MAN450207", "WTN220207", "LND110210"))]




stfips = data.frame(fips=1000*state.fips$fips)
#Adding non-continental states to data frame: Alaska 2000, Hawaii 15000
stfips[64,] <- 2000
stfips[65,] <- 15000

#Creating the states dataframe
statesfacts = county_facts[(county_facts$fips %in% stfips$fips),]
statesfacts$state_abbreviation <- NULL

#Removing states from county column in county facts and subsetting to a nw data frame
county_facts = county_facts[!(county_facts$fips %in% stfips$fips),]


#To get longitude and latitude of counties and states
states <- map_data("state")
counties <- map_data("county")
```

```{r}
#Checking missingness after cleaning
#County facts
aggr1_plotfacts <- aggr(county_facts, col = c('Blue','Purple'), numbers = TRUE, sortVars = TRUE, cex.axis = .8, gap = 3, ylab = c('County Facts Histogram of Missing Data','Pattern'))

#presidential election 2016 results
aggr1pres <- aggr(pres16results, col = c('Blue','Purple'), numbers = TRUE, sortVars = TRUE, cex.axis = .8, gap = 3, ylab = c('Presidential Results Histogram of Missing Data','Pattern'))

#wide results
aggr1meltwide <- aggr(mpe16rwvd9, col = c('Blue','Purple'), numbers = TRUE, sortVars = TRUE, cex.axis = .8, gap = 3, ylab = c('Wide Presidential Results Histogram of Missing Data','Pattern'))

#primary dataset
aggr1prim <- aggr(primres, col = c('Blue','Purple'), numbers = TRUE, sortVars = TRUE, cex.axis = .8, gap = 3, ylab = c('Primary Result Histogram of Missing Data','Pattern'))


```


```{r}

race = county_facts[-1,c(1:4, 11:18)]
setnames(race, old=c("PST045214", "state_abbreviation", "RHI125214","RHI225214", "RHI325214", "RHI425214", "RHI525214", "RHI625214", "RHI725214", 'RHI825214'), new=c("Population", "sa", "White", "Black", "Native American", "Asian", "Pacific Islander", "2+ Races", "Latino", "White/Not Latino"))


```



```{r}
whites = race[c(3, 5)]
blacks = race[c(3, 6)]
native = race[c(3, 7)]
asian = race[c(3, 8)]
pacific = race[c(3, 9)]
multi = race[c(3, 10)]
latin = race[c(3, 11)]
euro = race[c(3, 12)]

#The racial values converted to decimals and then multiplied by total population to get the whole number value of votes per county by race
bpop = 0.01*race['Black']*race['Population']
wpop = 0.01*race['White']*race['Population']
napop = 0.01*race['Native American']*race['Population']
apop = 0.01*race['Asian']*race['Population']
pipop = 0.01*race['Pacific Islander']*race['Population']
mupop = 0.01*race['2+ Races']*race['Population']
lpop = 0.01*race['Latino']*race['Population']
euro = 0.01*race['White/Not Latino']*race['Population']

#Sources list voter total of 137-139 Million
#Black about 15 Mil, White: , 

race2 =data.frame(race$fips, race$area_name, race$sa,  race$Population, wpop, bpop,  napop, apop, pipop, mupop, lpop, euro)


#Total number of votes from each race for the enitre election
totBl = sum(race2$Black)/1000000
totWh = sum(race2$White)/1000000
totNa = sum(race2$Native.American)/1000000
totAs = sum(race2$Asian)/1000000
totPi = sum(race2$Pacific.Islander)/1000000
totMu = sum(race2$X2..Races)/1000000
totLa = sum(race2$Latino)/1000000
totEu = sum(race2$White.Not.Latino)/1000000

totals = c(totAs, totBl, totLa, totMu, totNa, totPi, totWh, totEu)
```

```{r}

#barplot of total number of voters by race
barplot(totals, col=rainbow(8), names.arg = c("Asian", "Black", "Latino", "Mixed", "Native", "Pacific", "White", 'White/Not Latino'), main = "Total Votes by Race/Ethnicity", xlab = 'Races', ylab = "Votes in Millions")

#Same barplot, but withput the white vote for a better view of the others
barplot(totals[-c(7, 8)], col=rainbow(8), names.arg = c("Asian", "Black", "Latino", "Mixed", "Native", "Pacific"), main = "Total Votes by Race/Ethnicity, Excluding Euro-Americans & White Latinos", xlab = 'Races', ylab = "Votes in Millions")

#Same barplot, but withput the white vote for a better view of the others
barplot(totals[-c(1:2, 4:6)], col=rainbow(8), names.arg = c("Latino", "White", 'White/Not Latino'), main = "Total Votes of Euro-Americans, Latinos & White Latinos", xlab = 'Races', ylab = "Votes in Millions")
```

```{r}
#Boxplot of the percentages of votes per county by racial group
boxplot(race[c(5:10)])

#Summary of whole number of votes per county by race
summary(race2[c(5:10)])

```


```{r}
#GGplot bar graph example of each racial group

bar1 <- ggplot(data=whites, aes(x=sa))
bar1 + geom_bar() + 
  xlab("Counties") +  ylab("Percentages") + ggtitle("White Population percentage of Votes")

#Helps visualizing missing data
marginplot(whites)

barplot(race2$White)
qqPlot(race2$White)

#White votes versus all populations  
scatterplot(race2$White, race2$race.Population, xlim = c(0, 4000000), ylim = c(0,5000000),  xlab="Number of White Votes", ylab="Total Population per County")

#White votes versus populations between 500,000-1,000,000
scatterplot(race2$White, race2$race.Population, ylim= c(500000, 1000000), xlim = c(0,1000000), xlab="Number of White Votes", ylab="Population per County: 500,000-1,000,000")

#White votes versus populations between 100,000-500,000
scatterplot(race2$White, race2$race.Population, ylim= c(100000, 500000), xlim = c(0,1000000), xlab="Number of White Votes", ylab="Population per County: 100,000-500,000")

#White votes versus populations between 50,000-100,000
scatterplot(race2$White, race2$race.Population, ylim= c(50000, 100000), xlim = c(0,100000), xlab="Number of White Votes", ylab="Population per County: 50,000-100,000")

#White votes versus populations between 0-50,000
scatterplot(race2$White, race2$race.Population, ylim= c(0,50000), xlim = c(0,60000), xlab="Number of White Votes", ylab="Population per County: 0-50,000")

#Wisconsin White Voting whole number values 
WIWhitesBoxplotSubset = subset(race2, race.sa=="WI", select = c(race.area_name, race.Population, White, race.sa))

barplot(WIWhitesBoxplotSubset$White, col = rainbow(20), main = "Wisconsin Total Votes by County ", xlab = "Counties", ylab = "Number of Votes")

#California White Voting whole number values 
CAWhitesBoxplotSubset = subset(race2, race.sa=="CA", select = c(race.area_name, race.Population, White, race.sa))

barplot(CAWhitesBoxplotSubset$White, col = rainbow(20), main = "California Total Votes by County ", xlab = "Counties", ylab = "Number of Votes")

#Scatterplot of the relationship between population size and race
scatterplot(CAWhitesBoxplotSubset$White, CAWhitesBoxplotSubset$race.Population, main="California White Vote Versus Population", xlim = c(0, 300000), ylim=c(0, 400000))
```

```{r}
set.seed(1)    # for reproducible example
map.county <- map_data('county')
counties   <- unique(map.county[,5:6])
uscounties <- counties
uscounties

wvp= county_facts$RHI125214

white_mapus <- data.frame(state_names=uscounties$region, county_names=uscounties$subregion, wvp75=wvp[1:3076])


map.county <- data.table(map.county)
setkey(map.county,region,subregion)
white_mapus <- data.table(white_mapus)
setkey(white_mapus,state_names,county_names)
map.dfus      <- map.county[white_mapus]

ggplot(map.dfus, aes(x=long, y=lat, group=group, fill=wvp75), color = "black") + geom_polygon()+coord_map() + 
  borders(database = "county")

akmap.county <- map_data('county')
counties   <- unique(map.county[,5:6])
akcounties <- counties[counties$region=="arkansas",]
akcounties

white_map <- data.frame(state_names=akcounties$region,                  county_names=akcounties$subregion,wvp75=wvp[c(1:74, 1)])


akmap.county <- data.table(akmap.county[akmap.county$region=="arkansas",])
setkey(akmap.county,region,subregion)
white_mapak <- data.table(white_map)
setkey(white_mapak,state_names,county_names)
map.dfak      <- akmap.county[white_mapak]

ggplot(map.dfak, aes(x=long, y=lat, group=group, fill=wvp75)) + geom_polygon()+coord_map()

set.seed(1)    # for reproducible example
wimap.county <- map_data('county')
counties   <- unique(wimap.county[,5:6])
wicounties <- counties[counties$region=="wisconsin",]
wicounties

wiwhite_map <- data.frame(state_names=wicounties$region,                  county_names=wicounties$subregion,WIWhiteVotePercent=wvp[c(1:71, 1)])

wimap.county <- data.table(map.county[map.county$region=="wisconsin",])
setkey(wimap.county,region,subregion)
wiwhite_map <- data.table(wiwhite_map)
setkey(wiwhite_map,state_names,county_names)
map.dfwi      <- wimap.county[wiwhite_map]

ggplot(map.dfwi, aes(x=long, y=lat, group=group, fill=WIWhiteVotePercent)) + geom_polygon()+coord_map()

```


```{r fig.height=100, fig.width=100}
#Graphs of the democrats vs republic coutnies won
classcolors <- c('red', 'cyan' )
usmapDvR=map('county', fill= TRUE, col = classcolors[mpe16rwvd9$lead], resolution = 0) 
map('county', "wisconsin", fill= TRUE, col = classcolors[mpe16rwvd9$lead]) 
map('county', "California", fill= TRUE, col = classcolors[mpe16rwvd9$lead])
map('county', "new jersey", fill= TRUE, col = classcolors[mpe16rwvd9$lead])


```

```{r}
#Goal: Plot relationships between counties based on race votes
#Example: if Blacks voted one way in a wisconsin county, how do these votes comapre in other counties

nbpop = 0.01*race['Black']*race['Population']
nwpop = 0.01*race['White']*race['Population']

BvW =data.frame(nbpop, nwpop, county_facts[-1, "state_abbreviation"])
setnames(BvW, old=c('county_facts..1...state_abbreviation..'), new=c("sa"))

sBvW=subset(BvW, sa=="WI", select = c(Black, White, sa))


# BvWBar <- ggplot(data=sBvW, aes(x=state_abbreviation))
# BvWBar + geom_bar() + 
#   xlab("") +  ylab("") + ggtitle("")

scatterplot(sBvW$White, sBvW$Black, xlim = c(0, 100000), ylim = c(0, 1000))
```

```{r}
#Subsetting Trumps, Hillary and others votes
trump=subset(mpe16rwvd9[-1,], Candidates=="Donald.Trump", select = c(county, total_votes, Candidates, Votes))
dts = data.frame(trump$Votes/trump$total_votes)
trump = cbind(trump, percnt =dts)

hillary=subset(mpe16rwvd9[-1,], Candidates=="Hillary.Clinton", select = c(county, total_votes, Candidates, Votes))
hcs = data.frame(hillary$Votes/hillary$total_votes)
hillary = cbind(hillary, percnt=hcs)



```

```{r}
#Showing the level of support of Donald Trump in each county.
#Wyoming shows the lightest shade of Blue, representing the higher support for Trump
#Arkansas shows the lowest 

set.seed(1)
map.countytrump <- map_data('county')
counties   <- unique(map.countytrump[,5:6])
uscounties <- counties


dont = trump$trump.Votes.trump.total_votes

trumpsupport <- data.frame(state_names=uscounties$region, county_names=uscounties$subregion, dontrus=dont[1:3076])

map.countytrump <- data.table(map.countytrump)
setkey(map.countytrump,region,subregion)
trumpsupport <- data.table(trumpsupport)
setkey(trumpsupport,state_names,county_names)
map.dftrump      <- map.countytrump[trumpsupport]

ggplot(map.dftrump,  aes(x=long, y=lat, group=group, fill=dontrus), color = "black") + geom_polygon( )+coord_map() + 
  borders(database = "county") + ggtitle("Donald Trump County Support in Percentages")

```

```{r}
#Showing the level of support of Donald hillary in each county.
#Wyoming shows the lightest shade of Blue, representing the higher support for hillary
#Arkansas shows the lowest 

set.seed(1)
map.countyhillary <- map_data('county')
counties   <- unique(map.countyhillary[,5:6])
uscounties <- counties


hicl = hillary$hillary.Votes.hillary.total_votes

hillarysupport <- data.frame(state_names=uscounties$region, county_names=uscounties$subregion, hilclis=hicl[1:3076])

map.countyhillary <- data.table(map.countyhillary)
setkey(map.countyhillary,region,subregion)
hillarysupport <- data.table(hillarysupport)
setkey(hillarysupport,state_names,county_names)
map.dfhillary      <- map.countyhillary[hillarysupport]

ggplot(map.dfhillary, aes(x=long, y=lat, group=group, fill=hilclis), color = "white") + geom_polygon( )+coord_map() + 
  borders(database = "county")+ ggtitle("Hillary Clinton County Support in Percentages")


```
